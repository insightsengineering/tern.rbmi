<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introduction to tern.rbmi • tern.rbmi</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to tern.rbmi">
<link rel="stylesheet" href="../consent.css">
<script src="../consent.js" type="text/javascript" charset="utf-8"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tern.rbmi</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.4.9002</small>

    <div style="width: 140px; margin-left: 0.5rem;"> <small class="nav-text text-muted me-auto">part of</small> <img src="https://github.com/insightsengineering/hex-stickers/blob/main/PNG/nest.png?raw=true" alt="NEST" style="height: 30px;"><a href="https://pharmaverse.org/" class="external-link"><img src="https://github.com/insightsengineering/hex-stickers/blob/main/PNG/pharmaverse.png?raw=true" alt="pharmaverse" style="height: 28px;"></a> </div>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/tern-rbmi.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-reports" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Reports</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-reports">
<li><a class="dropdown-item" href="../coverage-report/">Coverage report</a></li>
    <li><a class="dropdown-item" href="../unit-test-report/">Unit test report</a></li>
    <li><a class="dropdown-item" href="../unit-test-report-non-cran/">Non-CRAN unit test report</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/insightsengineering/tern.rbmi"><span class="fa fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Introduction to tern.rbmi</h1>
            
            <h4 data-toc-skip class="date">2022-05-16</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/insightsengineering/tern.rbmi/blob/main/vignettes/tern-rbmi.Rmd" class="external-link"><code>vignettes/tern-rbmi.Rmd</code></a></small>
      <div class="d-none name"><code>tern-rbmi.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction-to-tern-rbmi">Introduction to tern.rbmi<a class="anchor" aria-label="anchor" href="#introduction-to-tern-rbmi"></a>
</h2>
<hr>
<p>This vignette shows the general purpose and syntax of the
<code>tern.rbmi</code> R package. The <code>tern.rbmi</code> provides an
interface for Reference Based Multiple Imputation (<code>rbmi</code>)
within the tern framework. For details of the <code>rbmi</code> package,
please see <a href="https://github.com/insightsengineering/rbmi" class="external-link">Reference Based
Multiple Imputation (rbmi)</a>. The basic usage of <code>rbmi</code>
core functions is described in the <code>quickstart</code> vignette:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/vignette.html" class="external-link">vignette</a></span><span class="op">(</span>topic <span class="op">=</span> <span class="st">"quickstart"</span>, package <span class="op">=</span> <span class="st">"rbmi"</span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
<div class="section level2">
<h2 id="example-of-using-tern-rbmi">Example of using <code>tern.rbmi</code><a class="anchor" aria-label="anchor" href="#example-of-using-tern-rbmi"></a>
</h2>
<p>The <code>rbmi</code> package consists of 4 core functions (plus
several helper functions) which are typically called in sequence:</p>
<ul>
<li>
<code>draws()</code> - fits the imputation models and stores their
parameters</li>
<li>
<code>impute()</code> - creates multiple imputed datasets</li>
<li>
<code>analyse()</code> - analyses each of the multiple imputed
datasets</li>
<li>
<code>pool()</code> - combines the analysis results across imputed
datasets into a single statistic</li>
</ul>
<div class="section level3">
<h3 id="the-data">The Data<a class="anchor" aria-label="anchor" href="#the-data"></a>
</h3>
<p>We use a publicly available example dataset from an antidepressant
clinical trial of an active drug versus placebo. The relevant endpoint
is the Hamilton 17-item depression rating scale (<code>HAMD17</code>)
which was assessed at baseline and at weeks 1, 2, 4, and 6. Study drug
discontinuation occurred in 24% of subjects from the active drug and 26%
of subjects from placebo. All data after study drug discontinuation are
missing and there is a single additional intermittent missing
observation.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/insightsengineering/tern.rbmi" class="external-link">tern.rbmi</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: rbmi</span></span>
<span><span class="co">#&gt; Loading required package: tern</span></span>
<span><span class="co">#&gt; Loading required package: rtables</span></span>
<span><span class="co">#&gt; Loading required package: formatters</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'formatters'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     %||%</span></span>
<span><span class="co">#&gt; Loading required package: magrittr</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'rtables'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:utils':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     str</span></span>
<span><span class="co">#&gt; Registered S3 method overwritten by 'tern':</span></span>
<span><span class="co">#&gt;   method   from </span></span>
<span><span class="co">#&gt;   tidy.glm broom</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">antidepressant_data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">THERAPY</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PLACEBO"</span>, <span class="st">"DRUG"</span><span class="op">)</span> <span class="co"># This is important! The order defines the computation order later</span></span>
<span></span>
<span><span class="va">missing_var</span> <span class="op">&lt;-</span> <span class="st">"CHANGE"</span></span>
<span><span class="va">vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  id <span class="op">=</span> <span class="st">"PATIENT"</span>,</span>
<span>  visit <span class="op">=</span> <span class="st">"VISIT"</span>,</span>
<span>  expand_vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BASVAL"</span>, <span class="st">"THERAPY"</span><span class="op">)</span>,</span>
<span>  group <span class="op">=</span> <span class="st">"THERAPY"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">covariates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  draws <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BASVAL*VISIT"</span>, <span class="st">"THERAPY*VISIT"</span><span class="op">)</span>,</span>
<span>  analyse <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"BASVAL"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">PATIENT</span>, <span class="va">THERAPY</span>, <span class="va">VISIT</span>, <span class="va">BASVAL</span>, <span class="va">THERAPY</span>, <span class="va">CHANGE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span>.cols <span class="op">=</span> <span class="va">vars</span><span class="op">$</span><span class="va">id</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">.x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span>.cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">vars</span><span class="op">$</span><span class="va">id</span>, <span class="va">vars</span><span class="op">$</span><span class="va">visit</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Use expand_locf to add rows corresponding to visits with missing outcomes to the dataset</span></span>
<span><span class="va">data_full</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span></span>
<span>  <span class="va">expand_locf</span>,</span>
<span>  args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">data</span>,</span>
<span>    vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">vars</span><span class="op">$</span><span class="va">expand_vars</span>, <span class="va">vars</span><span class="op">$</span><span class="va">group</span><span class="op">)</span>,</span>
<span>    group <span class="op">=</span> <span class="va">vars</span><span class="op">$</span><span class="va">id</span>,</span>
<span>    order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">vars</span><span class="op">$</span><span class="va">id</span>, <span class="va">vars</span><span class="op">$</span><span class="va">visit</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/append.html" class="external-link">append</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">vars</span><span class="op">$</span><span class="va">id</span>, <span class="va">vars</span><span class="op">$</span><span class="va">visit</span><span class="op">)</span><span class="op">]</span>, <span class="va">levels</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">data_full</span> <span class="op">&lt;-</span> <span class="va">data_full</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="va">vars</span><span class="op">$</span><span class="va">id</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="op">!</span><span class="op">!</span><span class="va">vars</span><span class="op">$</span><span class="va">group</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/funprog.html" class="external-link">Filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/funprog.html" class="external-link">Negate</a></span><span class="op">(</span><span class="va">is.na</span><span class="op">)</span>, <span class="va">.data</span><span class="op">[[</span><span class="va">vars</span><span class="op">$</span><span class="va">group</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># there are duplicates - use first value</span></span>
<span><span class="va">data_full</span> <span class="op">&lt;-</span> <span class="va">data_full</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">vars</span><span class="op">$</span><span class="va">id</span>, <span class="va">vars</span><span class="op">$</span><span class="va">group</span>, <span class="va">vars</span><span class="op">$</span><span class="va">visit</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># need to have a single ID column</span></span>
<span><span class="va">data_full</span> <span class="op">&lt;-</span> <span class="va">data_full</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/unite.html" class="external-link">unite</a></span><span class="op">(</span><span class="st">"TMP_ID"</span>, <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">all_of</a></span><span class="op">(</span><span class="va">vars</span><span class="op">$</span><span class="va">id</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"_#_"</span>, remove <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>TMP_ID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">TMP_ID</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="creating-intercurrent-event-data">Creating intercurrent event data<a class="anchor" aria-label="anchor" href="#creating-intercurrent-event-data"></a>
</h4>
<p>Set the imputation strategy to MAR for each patient with at least one
missing observation.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_ice</span> <span class="op">&lt;-</span> <span class="va">data_full</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span>.cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TMP_ID"</span>, <span class="va">vars</span><span class="op">$</span><span class="va">visit</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">.data</span><span class="op">[[</span><span class="va">missing_var</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">TMP_ID</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">all_of</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TMP_ID"</span>, <span class="va">vars</span><span class="op">$</span><span class="va">visit</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>strategy <span class="op">=</span> <span class="st">"MAR"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="draws">Draws<a class="anchor" aria-label="anchor" href="#draws"></a>
</h3>
<p>The <code><a href="https://insightsengineering.github.io/rbmi/reference/draws.html" class="external-link">rbmi::draws()</a></code> function fits the imputation models
and stores the corresponding parameter estimates or Bayesian posterior
parameter draws. The three main inputs to the <code><a href="https://insightsengineering.github.io/rbmi/reference/draws.html" class="external-link">rbmi::draws()</a></code>
function are:</p>
<ul>
<li>data - The primary longitudinal data.frame containing the outcome
variable and all covariates.</li>
<li>data_ice - A data.frame which specifies the first visit affected by
an intercurrent event (ICE) and the imputation strategy for handling
missing outcome data after the ICE. At most one ICE which is to be
imputed by a non-MAR strategy is allowed per subject.</li>
<li>method - The statistical method used to fit the imputation models
and to create imputed datasets.</li>
</ul>
<div class="section level4">
<h4 id="define-key-variables">Define key variables<a class="anchor" aria-label="anchor" href="#define-key-variables"></a>
</h4>
<p>Define the names of key variables in our dataset and the covariates
included in the imputation model using <code><a href="https://insightsengineering.github.io/rbmi/reference/set_vars.html" class="external-link">rbmi::set_vars()</a></code>.
Note that the covariates argument can also include interaction
terms.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">debug_mode</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span></span>
<span></span>
<span><span class="va">draws_vars</span> <span class="op">&lt;-</span> <span class="fu">rbmi</span><span class="fu">::</span><span class="fu"><a href="https://insightsengineering.github.io/rbmi/reference/set_vars.html" class="external-link">set_vars</a></span><span class="op">(</span></span>
<span>  outcome <span class="op">=</span> <span class="va">missing_var</span>,</span>
<span>  visit <span class="op">=</span> <span class="va">vars</span><span class="op">$</span><span class="va">visit</span>,</span>
<span>  group <span class="op">=</span> <span class="va">vars</span><span class="op">$</span><span class="va">group</span>,</span>
<span>  covariates <span class="op">=</span> <span class="va">covariates</span><span class="op">$</span><span class="va">draws</span></span>
<span><span class="op">)</span></span>
<span><span class="va">draws_vars</span><span class="op">$</span><span class="va">subjid</span> <span class="op">&lt;-</span> <span class="st">"TMP_ID"</span></span></code></pre></div>
<p>Define which imputation method to use, then create samples for the
imputation parameters by running the <code>draws()</code> function.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">draws_method</span> <span class="op">&lt;-</span> <span class="fu">method_bayes</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">draws_obj</span> <span class="op">&lt;-</span> <span class="fu">rbmi</span><span class="fu">::</span><span class="fu"><a href="https://insightsengineering.github.io/rbmi/reference/draws.html" class="external-link">draws</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">data_full</span>,</span>
<span>  data_ice <span class="op">=</span> <span class="va">data_ice</span>,</span>
<span>  vars <span class="op">=</span> <span class="va">draws_vars</span>,</span>
<span>  method <span class="op">=</span> <span class="va">draws_method</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; SAMPLING FOR MODEL 'MMRM' NOW (CHAIN 1).</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1: Gradient evaluation took 0.000361 seconds</span></span>
<span><span class="co">#&gt; Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 3.61 seconds.</span></span>
<span><span class="co">#&gt; Chain 1: Adjust your expectations accordingly!</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1: Iteration:    1 / 1200 [  0%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  120 / 1200 [ 10%]  (Warmup)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  201 / 1200 [ 16%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  320 / 1200 [ 26%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  440 / 1200 [ 36%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  560 / 1200 [ 46%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  680 / 1200 [ 56%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  800 / 1200 [ 66%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration:  920 / 1200 [ 76%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 1040 / 1200 [ 86%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 1160 / 1200 [ 96%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: Iteration: 1200 / 1200 [100%]  (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1: </span></span>
<span><span class="co">#&gt; Chain 1:  Elapsed Time: 0.535 seconds (Warm-up)</span></span>
<span><span class="co">#&gt; Chain 1:                2.259 seconds (Sampling)</span></span>
<span><span class="co">#&gt; Chain 1:                2.794 seconds (Total)</span></span>
<span><span class="co">#&gt; Chain 1:</span></span>
<span><span class="co">#&gt; Warning in fit_mcmc(designmat = model_df_scaled[, -1, drop = FALSE], outcome = model_df_scaled[, : The largest R-hat is 1.16, indicating chains have not mixed.</span></span>
<span><span class="co">#&gt; Running the chains for more iterations may help. See</span></span>
<span><span class="co">#&gt; https://mc-stan.org/misc/warnings.html#r-hat</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="impute">Impute<a class="anchor" aria-label="anchor" href="#impute"></a>
</h3>
<p>The next step is to use the parameters from the imputation model to
generate the imputed datasets. This is done via the
<code><a href="https://insightsengineering.github.io/rbmi/reference/impute.html" class="external-link">rbmi::impute()</a></code> function. The function only has two key
inputs: the imputation model output from <code><a href="https://insightsengineering.github.io/rbmi/reference/draws.html" class="external-link">rbmi::draws()</a></code> and
the reference groups relevant to reference-based imputation methods. Its
usage is thus:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">impute_references</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"DRUG"</span> <span class="op">=</span> <span class="st">"PLACEBO"</span>, <span class="st">"PLACEBO"</span> <span class="op">=</span> <span class="st">"PLACEBO"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">impute_obj</span> <span class="op">&lt;-</span> <span class="fu">rbmi</span><span class="fu">::</span><span class="fu"><a href="https://insightsengineering.github.io/rbmi/reference/impute.html" class="external-link">impute</a></span><span class="op">(</span></span>
<span>  <span class="va">draws_obj</span>,</span>
<span>  references <span class="op">=</span> <span class="va">impute_references</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="analyze">Analyze<a class="anchor" aria-label="anchor" href="#analyze"></a>
</h3>
<p>The next step is to run the analysis model on each imputed dataset.
This is done by defining an analysis function and then calling
<code><a href="https://insightsengineering.github.io/rbmi/reference/analyse.html" class="external-link">rbmi::analyse()</a></code> to apply this function to each imputed
dataset.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define analysis model</span></span>
<span><span class="va">analyse_fun</span> <span class="op">&lt;-</span> <span class="va">ancova</span></span>
<span></span>
<span><span class="va">ref_levels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">impute_obj</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">group</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">ref_levels</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ref"</span>, <span class="st">"alt"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">analyse_obj</span> <span class="op">&lt;-</span> <span class="fu">rbmi</span><span class="fu">::</span><span class="fu"><a href="https://insightsengineering.github.io/rbmi/reference/analyse.html" class="external-link">analyse</a></span><span class="op">(</span></span>
<span>  imputations <span class="op">=</span> <span class="va">impute_obj</span>,</span>
<span>  fun <span class="op">=</span> <span class="va">analyse_fun</span>,</span>
<span>  vars <span class="op">=</span> <span class="fu">rbmi</span><span class="fu">::</span><span class="fu"><a href="https://insightsengineering.github.io/rbmi/reference/set_vars.html" class="external-link">set_vars</a></span><span class="op">(</span></span>
<span>    subjid <span class="op">=</span> <span class="st">"TMP_ID"</span>,</span>
<span>    outcome <span class="op">=</span> <span class="va">missing_var</span>,</span>
<span>    visit <span class="op">=</span> <span class="va">vars</span><span class="op">$</span><span class="va">visit</span>,</span>
<span>    group <span class="op">=</span> <span class="va">vars</span><span class="op">$</span><span class="va">group</span>,</span>
<span>    covariates <span class="op">=</span> <span class="va">covariates</span><span class="op">$</span><span class="va">analyse</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="pool">Pool<a class="anchor" aria-label="anchor" href="#pool"></a>
</h3>
<p>The <code><a href="https://insightsengineering.github.io/rbmi/reference/pool.html" class="external-link">rbmi::pool()</a></code> function can be used to summarize the
analysis results across multiple imputed datasets to provide an overall
statistic with a standard error, confidence intervals and a p-value for
the hypothesis test of the null hypothesis that the effect is equal to
0.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pool_obj</span> <span class="op">&lt;-</span> <span class="fu">rbmi</span><span class="fu">::</span><span class="fu"><a href="https://insightsengineering.github.io/rbmi/reference/pool.html" class="external-link">pool</a></span><span class="op">(</span></span>
<span>  results <span class="op">=</span> <span class="va">analyse_obj</span>,</span>
<span>  conf.level <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  alternative <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"two.sided"</span>, <span class="st">"less"</span>, <span class="st">"greater"</span><span class="op">)</span>,</span>
<span>  type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"percentile"</span>, <span class="st">"normal"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="create-output">Create output<a class="anchor" aria-label="anchor" href="#create-output"></a>
</h3>
<p>Finally create output with <code>rtables</code> and <code>tern</code>
packages</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://broom.tidymodels.org/" class="external-link">broom</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">pool_obj</span><span class="op">)</span></span>
<span><span class="va">df</span></span>
<span><span class="co">#&gt;   group       est    se_est lower_cl_est upper_cl_est   est_contr  se_contr</span></span>
<span><span class="co">#&gt; 1   ref -1.615820 0.4862316    -2.575771   -0.6558685          NA        NA</span></span>
<span><span class="co">#&gt; 2   alt -1.707626 0.4749573    -2.645319   -0.7699335 -0.09180645 0.6826279</span></span>
<span><span class="co">#&gt; 3   ref -4.251655 0.6496811    -5.534780   -2.9685296          NA        NA</span></span>
<span><span class="co">#&gt; 4   alt -2.809056 0.6324950    -4.058140   -1.5599722  1.44259881 0.9093545</span></span>
<span><span class="co">#&gt; 5   ref -6.440519 0.7279670    -7.880636   -5.0004032          NA        NA</span></span>
<span><span class="co">#&gt; 6   alt -4.194777 0.6890509    -5.556260   -2.8332948  2.24574209 1.0256389</span></span>
<span><span class="co">#&gt; 7   ref -7.682997 0.8037188    -9.274081   -6.0919124          NA        NA</span></span>
<span><span class="co">#&gt; 8   alt -4.868448 0.7615558    -6.374030   -3.3628674  2.81454841 1.1248318</span></span>
<span><span class="co">#&gt;   lower_cl_contr upper_cl_contr    p_value relative_reduc visit conf_level</span></span>
<span><span class="co">#&gt; 1             NA             NA         NA             NA     4       0.95</span></span>
<span><span class="co">#&gt; 2     -1.4394968       1.255884 0.89317724     0.05681725     4       0.95</span></span>
<span><span class="co">#&gt; 3             NA             NA         NA             NA     5       0.95</span></span>
<span><span class="co">#&gt; 4     -0.3532555       3.238453 0.11461872    -0.33930289     5       0.95</span></span>
<span><span class="co">#&gt; 5             NA             NA         NA             NA     6       0.95</span></span>
<span><span class="co">#&gt; 6      0.2164236       4.275061 0.03035798    -0.34868960     6       0.95</span></span>
<span><span class="co">#&gt; 7             NA             NA         NA             NA     7       0.95</span></span>
<span><span class="co">#&gt; 8      0.5881156       5.040981 0.01364909    -0.36633471     7       0.95</span></span></code></pre></div>
<p>Final product, reshape <code>rbmi</code> final results to nicely
formatted <code>rtable</code> object.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://insightsengineering.github.io/rtables/latest-tag/reference/basic_table.html" class="external-link">basic_table</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://insightsengineering.github.io/rtables/latest-tag/reference/split_cols_by.html" class="external-link">split_cols_by</a></span><span class="op">(</span><span class="st">"group"</span>, ref_group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">group</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://insightsengineering.github.io/rtables/latest-tag/reference/split_rows_by.html" class="external-link">split_rows_by</a></span><span class="op">(</span><span class="st">"visit"</span>, split_label <span class="op">=</span> <span class="st">"Visit"</span>, label_pos <span class="op">=</span> <span class="st">"topleft"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/summarize_rbmi.html">summarize_rbmi</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://insightsengineering.github.io/rtables/latest-tag/reference/build_table.html" class="external-link">build_table</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span><span class="co">#&gt; Visit                                       ref                alt       </span></span>
<span><span class="co">#&gt; —————————————————————————————————————————————————————————————————————————</span></span>
<span><span class="co">#&gt; 4                                                                        </span></span>
<span><span class="co">#&gt;   Adjusted Mean (SE)                   -1.616 (0.486)     -1.708 (0.475) </span></span>
<span><span class="co">#&gt;     95% CI                            (-2.576, -0.656)   (-2.645, -0.770)</span></span>
<span><span class="co">#&gt;   Difference in Adjusted Means (SE)                       -0.092 (0.683) </span></span>
<span><span class="co">#&gt;     95% CI                                               (-1.439, 1.256) </span></span>
<span><span class="co">#&gt;     Relative Reduction (%)                                     5.7%      </span></span>
<span><span class="co">#&gt;     p-value (RBMI)                                            0.8932     </span></span>
<span><span class="co">#&gt; 5                                                                        </span></span>
<span><span class="co">#&gt;   Adjusted Mean (SE)                   -4.252 (0.650)     -2.809 (0.632) </span></span>
<span><span class="co">#&gt;     95% CI                            (-5.535, -2.969)   (-4.058, -1.560)</span></span>
<span><span class="co">#&gt;   Difference in Adjusted Means (SE)                       1.443 (0.909)  </span></span>
<span><span class="co">#&gt;     95% CI                                               (-0.353, 3.238) </span></span>
<span><span class="co">#&gt;     Relative Reduction (%)                                    -33.9%     </span></span>
<span><span class="co">#&gt;     p-value (RBMI)                                            0.1146     </span></span>
<span><span class="co">#&gt; 6                                                                        </span></span>
<span><span class="co">#&gt;   Adjusted Mean (SE)                   -6.441 (0.728)     -4.195 (0.689) </span></span>
<span><span class="co">#&gt;     95% CI                            (-7.881, -5.000)   (-5.556, -2.833)</span></span>
<span><span class="co">#&gt;   Difference in Adjusted Means (SE)                       2.246 (1.026)  </span></span>
<span><span class="co">#&gt;     95% CI                                                (0.216, 4.275) </span></span>
<span><span class="co">#&gt;     Relative Reduction (%)                                    -34.9%     </span></span>
<span><span class="co">#&gt;     p-value (RBMI)                                            0.0304     </span></span>
<span><span class="co">#&gt; 7                                                                        </span></span>
<span><span class="co">#&gt;   Adjusted Mean (SE)                   -7.683 (0.804)     -4.868 (0.762) </span></span>
<span><span class="co">#&gt;     95% CI                            (-9.274, -6.092)   (-6.374, -3.363)</span></span>
<span><span class="co">#&gt;   Difference in Adjusted Means (SE)                       2.815 (1.125)  </span></span>
<span><span class="co">#&gt;     95% CI                                                (0.588, 5.041) </span></span>
<span><span class="co">#&gt;     Relative Reduction (%)                                    -36.6%     </span></span>
<span><span class="co">#&gt;     p-value (RBMI)                                            0.0136</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="nest">
  <p>tern.rbmi is a part of the <strong>NEST</strong> and <a href="https://pharmaverse.org/" class="external-link"><strong>pharmaverse</strong></a>.</p>
</div>
<script type="text/javascript" src="../analytics.js"></script></footer>
</div>





  </body>
</html>
